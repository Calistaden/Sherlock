<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moriarty box Box ‚Äì Puzzle Game</title>

<style>
body {
  font-family: 'Georgia', serif;
  background: #e9dfc5 url('https://upload.wikimedia.org/wikipedia/commons/0/0e/Old_paper_background.jpg') repeat;
  color: #2a2a2a;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 25px;
  text-align: center;
}

h1 {
  margin-bottom: 20px;
  font-size: 2.3rem;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

p.description {
  margin-bottom: 30px;
  line-height: 1.5;
}

#hints {
  display: inline-block;
  text-align: center;
  background: rgba(233,223,197,0.6); /* couleur proche du fond */
  padding: 15px 20px;
  border-radius: 10px;
  line-height: 1.6;
  margin-bottom: 30px;
}

#grid-container {
  position: relative;
  margin-top: 20px;
}

/* Grille */
#grid {
  display: grid;
  grid-template-columns: repeat(3, 70px);
  grid-template-rows: repeat(3, 70px);
  gap: 10px;
}

/* Indicateurs aux coins */
.corner-indicator {
  position: absolute;
  width: 26px;
  height: 26px;
  border-radius: 6px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.25);
  border: 2px solid #1976d2; /* Bordure bleu */
}

/* Positions des indicateurs */
#ind-top-left { top: -35px; left: -35px; background: #1976d2; }
#ind-top-right { top: -35px; right: -35px; background: #1976d2; }
#ind-bottom-left { bottom: -50px; left: -35px; background: #1976d2; }
#ind-bottom-right { bottom: -50px; right: -35px; background: #1976d2; }

/* Cases */
.cell {
  width: 70px;
  height: 70px;
  cursor: pointer;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  transition: transform 0.15s ease, box-shadow 0.2s ease;
}

.cell:active {
  transform: scale(0.92);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* Couleurs */
.cell.black { background: linear-gradient(145deg, #1b1b1b, #333); }
.cell.green { background: linear-gradient(145deg, #2e7d32, #4caf50); }
.cell.blue { background: linear-gradient(145deg, #1976d2, #42a5f5); }
.cell.violet { background: linear-gradient(145deg, #6a1b9a, #ab47bc); }
.cell.gray { background: linear-gradient(145deg, #a6a6a6, #cfcfcf); }

button {
  padding: 10px 24px;
  margin-top: 50px;
  font-size: 1.05rem;
  border-radius: 8px;
  border: none;
  background-color: #3b2f2f;
  color: #fff;
  cursor: pointer;
  transition: 0.2s;
  box-shadow: 0 3px 8px rgba(0,0,0,0.3);
}

button:hover {
  background-color: #2a2121;
  transform: translateY(-2px);
}

#moves {
  margin-top: 15px;
  font-size: 1.2rem;
  font-weight: bold;
}

#message {
  margin-top: 15px;
  font-weight: bold;
  font-size: 1.35rem;
  color: #1f7a1f;
}

ul{
    list-style-type: none;
}

</style>
</head>

<body>
<h1>Moriarty box</h1>
<p class="description">Encore une √©trange bo√Æte orn√©e de tuiles color√©es.<br>
Une inscription presque effac√©e est visible sur le dessous de la bo√Æte : 
<div id="hints"><i>
          <div><strong style="color: grey;">Le Silence</strong> retient son souffle, le monde continuera bien sans lui</div>
		  <div><strong style="color: black;">L‚ÄôOmbre</strong> fait glisser le monde sur son passage.</div>
          <div><strong style="color: green;">Le Miroir</strong> √©change sa place avec son reflet.</div>
		  <div><strong style="color: purple;">La Chute</strong> et <strong style="color: goldenrod;">L'ascension</strong> s'opposent. l'une creuse sa tombe et l'autre s'√©l√®ve aux cieux.</div>
          <div><strong style="color: blue;">L‚ÄôApprenti</strong> immite son ma√Ætre qui r√®gne</div>
		  <div><strong style="color: orange;">Le Conformiste</strong> se rallie √† la majorit√©</div>
</i></div>
Il doit bien y avoir une fa√ßon de l'ouvrir...</p>
<!-- Solution : 13232146 -->
<div id="grid-container">
  <!-- Indicateurs de victoire -->
  <div id="ind-top-left" class="corner-indicator"></div>
  <div id="ind-top-right" class="corner-indicator"></div>
  <div id="ind-bottom-left" class="corner-indicator"></div>
  <div id="ind-bottom-right" class="corner-indicator"></div>

  <div id="grid"></div>
</div>

<button onclick="resetGrid()">R√©initialiser la grille</button>
<div id="moves">Coups : 0</div>
<div id="message"></div>

<script>
const size = 3;
let cells = [];
let moveCount = 0;

const initialSetup = [
  ['black','green','blue'],
  ['blue','blue','blue'],
  ['violet','gray','gray']
];

const grid = document.getElementById('grid');

/* ========= INITIALISATION ========= */

function updateMoveDisplay() {
  document.getElementById("moves").textContent = "Coups : " + moveCount;
}

function createGrid(){
  grid.innerHTML = '';
  cells = [];

  for(let i=0; i<size; i++){
    cells[i] = [];
    for(let j=0; j<size; j++){
      const div = document.createElement('div');
      div.className = 'cell ' + initialSetup[i][j];
      div.dataset.row = i;
      div.dataset.col = j;
      div.addEventListener('click', handleClick);
      grid.appendChild(div);
      cells[i][j] = div;
    }
  }

  moveCount = 0;
  updateMoveDisplay();
  document.getElementById('message').textContent = '';
}

createGrid();

/* ========= UTILITAIRES ========= */

const COLORS = ['black','green','blue','violet','gray'];

function getColor(r, c){
  return [...cells[r][c].classList].find(cl => COLORS.includes(cl));
}

function setColor(r, c, color){
  cells[r][c].className = 'cell ' + color;
}

function snapshotColors(){
  return cells.map(row => row.map(cell =>
    [...cell.classList].find(cl => COLORS.includes(cl))
  ));
}

function hasChanged(before, after){
  return JSON.stringify(before) !== JSON.stringify(after);
}

/* ========= EFFETS ========= */

// NOIR : d√©cale la ligne √† droite
function effectBlack(row){
  const rowColors = cells[row].map((_,j) => getColor(row,j));
  for(let j=0;j<size;j++){
    setColor(row,(j+1)%size,rowColors[j]);
  }
}

// VERT : √©change avec la case oppos√©e
function effectGreen(row,col){
  if(row === 1 && col === 1) return;

  const selfColor = getColor(row,col);
  const oppRow = 2 - row;
  const oppCol = 2 - col;
  const oppColor = getColor(oppRow, oppCol);

  setColor(row,col,oppColor);
  setColor(oppRow,oppCol,selfColor);
}

// VIOLET : √©change avec la case du dessous
function effectViolet(row,col){
  if(row >= 2) return;

  const selfColor = getColor(row,col);
  const belowColor = getColor(row+1,col);

  setColor(row,col,belowColor);
  setColor(row+1,col,selfColor);
}

/* ========= CLIC ========= */

function handleClick(e){
  const before = snapshotColors();

  const cell = e.target;
  const row = Number(cell.dataset.row);
  const col = Number(cell.dataset.col);
  const color = getColor(row,col);

  if(color === 'black'){
    effectBlack(row);
  }
  else if(color === 'green'){
    effectGreen(row,col);
  }
  else if(color === 'violet'){
    effectViolet(row,col);
  }
  else if(color === 'blue'){
    const midColor = getColor(1,1);

    if(midColor === 'black') effectBlack(row);
    else if(midColor === 'green') effectGreen(row,col);
    else if(midColor === 'violet') effectViolet(row,col);
  }

  const after = snapshotColors();
  if(hasChanged(before, after)){
    moveCount++;
    updateMoveDisplay();
  }

  checkVictory();
}

/* ========= DIVERS ========= */

function resetGrid(){
  createGrid();
}

function checkVictory(){
  if(
    getColor(0,0)==='blue' &&
    getColor(0,2)==='blue' &&
    getColor(2,0)==='blue' &&
    getColor(2,2)==='blue'
  ){
    document.getElementById('message').textContent =
      'üéâ Victoire ! Les 4 coins sont bleus !';
  } else {
    document.getElementById('message').textContent = '';
  }
}
</script>
