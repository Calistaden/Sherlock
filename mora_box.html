<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mora Jai Box ‚Äì Puzzle Game</title>

<style>
body {
  font-family: 'Georgia', serif;
  background: #e9dfc5 url('https://upload.wikimedia.org/wikipedia/commons/0/0e/Old_paper_background.jpg') repeat;
  color: #2a2a2a;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 25px;
  text-align: center;
}

h1 {
  margin-bottom: 20px; /* plus d'espace avant les indicateurs du haut */
  font-size: 2.3rem;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

p.description {
  margin-bottom: 30px; /* espace entre texte et grille */
}

/* ---- Grille + Indicateurs ---- */

#grid-container {
  position: relative;
  margin-top: 20px;
}

#grid {
  display: grid;
  grid-template-columns: repeat(3, 70px);
  grid-template-rows: repeat(3, 70px);
  gap: 10px;
}

/* Indicateurs aux coins */
.corner-indicator {
  position: absolute;
  width: 26px;
  height: 26px;
  border-radius: 6px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.25);
  border: 2px solid rgba(0,0,0,0.4);
}

/* Positions */
#ind-top-left { top: -35px; left: -35px; }
#ind-top-right { top: -35px; right: -35px; }
#ind-bottom-left { bottom: -50px; left: -35px; }
#ind-bottom-right { bottom: -50px; right: -35px; }

/* ---- Cases de la grille ---- */

.cell {
  width: 70px;
  height: 70px;
  cursor: pointer;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  transition: transform 0.15s ease, box-shadow 0.2s ease;
}

.cell:active {
  transform: scale(0.92);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.cell.black { background: linear-gradient(145deg, #1b1b1b, #333); }
.cell.gray { background: linear-gradient(145deg, #a6a6a6, #cfcfcf); }
.cell.orange { background: linear-gradient(145deg, #d87a1f, #f3a43b); }
.cell.yellow { background: linear-gradient(145deg, #d1c638, #f1e76d); }

/* ---- Boutons et textes ---- */

button {
  padding: 10px 24px;
  margin-top: 50px; /* bouton beaucoup plus bas */
  font-size: 1.05rem;
  border-radius: 8px;
  border: none;
  background-color: #3b2f2f;
  color: #fff;
  cursor: pointer;
  transition: 0.2s;
  box-shadow: 0 3px 8px rgba(0,0,0,0.3);
}

button:hover {
  background-color: #2a2121;
  transform: translateY(-2px);
}

#moves {
  margin-top: 15px; /* sous le bouton */
  font-size: 1.2rem;
  font-weight: bold;
}

#message {
  margin-top: 15px;
  font-weight: bold;
  font-size: 1.35rem;
  color: #1f7a1f;
}
</style>
</head>

<body>
<h1>Mora Jai Box</h1>
<p class="description">Un puzzle inspir√© des m√©canismes d'escape games. 74244499878</p>

<!-- Grille + Indicateurs -->
<div id="grid-container">

  <div id="ind-top-left" class="corner-indicator" style="background:#1b1b1b"></div>
  <div id="ind-top-right" class="corner-indicator" style="background:#1b1b1b"></div>
  <div id="ind-bottom-left" class="corner-indicator" style="background:#1b1b1b"></div>
  <div id="ind-bottom-right" class="corner-indicator" style="background:#1b1b1b"></div>

  <div id="grid"></div>
</div>

<button onclick="resetGrid()">R√©initialiser la grille</button>
<div id="moves">Coups : 0</div>

<div id="message"></div>

<script>
const size = 3;
let cells = [];
let moveCount = 0;

const initialSetup = [
  ['black','black','black'],
  ['orange','gray','orange'],
  ['yellow','gray','yellow']
];

const grid = document.getElementById('grid');

function updateMoveDisplay() {
  document.getElementById("moves").textContent = "Coups : " + moveCount;
}

function createGrid(){
  grid.innerHTML = '';
  cells = [];

  for(let i=0; i<size; i++){
    cells[i] = [];
    for(let j=0; j<size; j++){
      const div = document.createElement('div');
      div.className = 'cell ' + initialSetup[i][j];
      div.dataset.row = i;
      div.dataset.col = j;
      div.addEventListener('click', handleClick);
      grid.appendChild(div);
      cells[i][j] = div;
    }
  }

  document.getElementById('message').textContent = '';
  moveCount = 0;
  updateMoveDisplay();
}
createGrid();

function getColor(r, c){
  return [...cells[r][c].classList].find(x =>
    ['black','gray','orange','yellow'].includes(x)
  );
}

function setColor(r, c, color){
  cells[r][c].className = 'cell ' + color;
}

function handleClick(e){
  const before = snapshotColors();

  const cell = e.target;
  const row = parseInt(cell.dataset.row);
  const col = parseInt(cell.dataset.col);
  const color = getColor(row, col);

  if(color === 'black'){
    const rowColors = cells[row].map((c,j) => getColor(row, j));
    for(let j=0;j<size;j++){
      const newIndex = (j+1)%size;
      setColor(row, newIndex, rowColors[j]);
    }
  }

  else if(color === 'orange'){
    const adjacent = [];
    if (row > 0) adjacent.push(getColor(row - 1, col));
    if (row < size - 1) adjacent.push(getColor(row + 1, col));
    if (col > 0) adjacent.push(getColor(row, col - 1));
    if (col < size - 1) adjacent.push(getColor(row, col + 1));

    const counts = {};
    adjacent.forEach(c => counts[c] = (counts[c] || 0) + 1);

    let best = null;
    let bestCount = 0;
    let tie = false;

    for(const c in counts){
      if(counts[c] > bestCount){
        best = c;
        bestCount = counts[c];
        tie = false;
      } else if(counts[c] === bestCount){
        tie = true;
      }
    }

    if(!tie){
      setColor(row, col, best);
    }
  }

  else if(color === 'yellow'){
    if(row > 0){
      const above = getColor(row - 1, col);
      const current = color;
      setColor(row - 1, col, current);
      setColor(row, col, above);
    }
  }

  const after = snapshotColors();

  if(hasChanged(before, after)){
    moveCount++;
    updateMoveDisplay();
  }

  checkVictory();
}

function snapshotColors(){
  return cells.map(row =>
    row.map(cell =>
      [...cell.classList].find(c => ['black','gray','orange','yellow'].includes(c))
    )
  );
}

function hasChanged(before, after){
  for(let i=0;i<size;i++){
    for(let j=0;j<size;j++){
      if(before[i][j] !== after[i][j]) return true;
    }
  }
  return false;
}

function resetGrid(){
  createGrid();
}

function checkVictory(){
  if(
    getColor(0,0)==='black' &&
    getColor(0,2)==='black' &&
    getColor(2,0)==='black' &&
    getColor(2,2)==='black'
  ){
    document.getElementById('message').textContent = 'üéâ Victoire ! Les 4 coins sont noirs !';
  } else {
    document.getElementById('message').textContent = '';
  }
}
</script>

</body>
</html>
